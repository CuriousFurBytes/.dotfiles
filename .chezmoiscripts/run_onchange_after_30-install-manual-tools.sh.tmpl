#!/bin/bash
set -e

# Hash: {{ include "packages.yml" | sha256sum }}

echo "Installing manual tools..."

{{ if eq .chezmoi.os "linux" }}
# eza - modern ls replacement
if ! command -v eza &> /dev/null; then
    echo "Installing eza..."
    cargo install eza || {
        wget -c https://github.com/eza-community/eza/releases/latest/download/eza_x86_64-unknown-linux-gnu.tar.gz -O - | tar xz
        sudo chmod +x eza
        sudo mv eza /usr/local/bin/
    }
else
    echo "✓ eza already installed, skipping"
fi

# zoxide
if ! command -v zoxide &> /dev/null; then
    echo "Installing zoxide..."
    curl -sS https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | bash
else
    echo "✓ zoxide already installed, skipping"
fi

# glow
if ! command -v glow &> /dev/null; then
    echo "Installing glow..."
    wget https://github.com/charmbracelet/glow/releases/latest/download/glow_Linux_x86_64.tar.gz
    tar -xzf glow_Linux_x86_64.tar.gz
    sudo mv glow /usr/local/bin/
    rm glow_Linux_x86_64.tar.gz
else
    echo "✓ glow already installed, skipping"
fi

# bottom
if ! command -v btm &> /dev/null; then
    echo "Installing bottom..."
    wget https://github.com/ClementTsang/bottom/releases/latest/download/bottom_x86_64-unknown-linux-gnu.tar.gz
    tar -xzf bottom_x86_64-unknown-linux-gnu.tar.gz
    sudo mv btm /usr/local/bin/
    rm bottom_x86_64-unknown-linux-gnu.tar.gz
else
    echo "✓ bottom already installed, skipping"
fi

# zellij
if ! command -v zellij &> /dev/null; then
    echo "Installing zellij..."
    bash <(curl -L https://github.com/zellij-org/zellij/releases/latest/download/zellij-x86_64-unknown-linux-musl.tar.gz) | tar -xz
    sudo mv zellij /usr/local/bin/
else
    echo "✓ zellij already installed, skipping"
fi

# Monaspace fonts
if [ ! -d "$HOME/.local/share/fonts/monaspace" ]; then
    echo "Installing Monaspace fonts..."
    mkdir -p ~/.local/share/fonts
    wget https://github.com/githubnext/monaspace/releases/latest/download/monaspace-v1.000.zip
    unzip monaspace-v1.000.zip -d ~/.local/share/fonts/
    fc-cache -f -v
    rm monaspace-v1.000.zip
else
    echo "✓ Monaspace fonts already installed, skipping"
fi

# fresh (Linux only - installed via Homebrew on macOS)
if ! command -v fresh &> /dev/null; then
    echo "Installing fresh editor..."
    curl -fsSL https://raw.githubusercontent.com/sinelaw/fresh/refs/heads/master/scripts/install.sh | sh
else
    echo "✓ fresh already installed, skipping"
fi
{{ end }}

# nvm (both OS)
if [ ! -d "$HOME/.nvm" ]; then
    echo "Installing nvm..."
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/master/install.sh | bash
else
    echo "✓ nvm already installed, skipping"
fi

# oh-my-zsh (both OS)
if [ ! -d "$HOME/.oh-my-zsh" ]; then
    echo "Installing oh-my-zsh..."
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
else
    echo "✓ oh-my-zsh already installed, skipping"
fi

# zsh-autosuggestions
AUTOSUGGESTIONS_DIR="${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-autosuggestions"
if [ ! -d "$AUTOSUGGESTIONS_DIR" ]; then
    echo "Installing zsh-autosuggestions..."
    git clone https://github.com/zsh-users/zsh-autosuggestions "$AUTOSUGGESTIONS_DIR" || echo "✓ zsh-autosuggestions already exists, skipping"
else
    echo "✓ zsh-autosuggestions already installed, skipping"
fi

# zsh-syntax-highlighting
SYNTAX_HIGHLIGHTING_DIR="${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting"
if [ ! -d "$SYNTAX_HIGHLIGHTING_DIR" ]; then
    echo "Installing zsh-syntax-highlighting..."
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git "$SYNTAX_HIGHLIGHTING_DIR" || echo "✓ zsh-syntax-highlighting already exists, skipping"
else
    echo "✓ zsh-syntax-highlighting already installed, skipping"
fi

# pure prompt
if [ ! -d "$HOME/.zsh/pure" ]; then
    echo "Installing pure prompt..."
    mkdir -p "$HOME/.zsh"
    git clone https://github.com/sindresorhus/pure.git "$HOME/.zsh/pure" || echo "✓ pure prompt already exists, skipping"
else
    echo "✓ pure prompt already installed, skipping"
fi
