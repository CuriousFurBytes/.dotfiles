#!/bin/bash
set -e

# This script runs whenever packages.json changes
# Hash: {{ include "packages.json" | sha256sum }}

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

# Ensure python3 is available
if ! command -v python3 &>/dev/null; then
{{ if eq .chezmoi.os "darwin" }}
    echo "Installing Python via Homebrew..."
    brew install python3
{{ else }}
{{ if eq .chezmoi.osRelease.id "fedora" }}
    echo "Installing Python via dnf..."
    sudo dnf install -y python3
{{ else }}
    echo "Installing Python via apt..."
    sudo apt update && sudo apt install -y python3
{{ end }}
{{ end }}
fi

{{ if eq .chezmoi.os "darwin" }}
python3 -B "{{ .chezmoi.sourceDir }}/.install_packages.py" "darwin"
{{ else }}
python3 -B "{{ .chezmoi.sourceDir }}/.install_packages.py" {{ .chezmoi.osRelease.id | quote }}
{{ end }}
